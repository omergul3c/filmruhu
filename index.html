<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ruh Haline Göre Film Önerileri</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
    body {
      background-color: #212529;
      color: #f8f9fa;
    }
    .card {
      background-color: #343a40;
      color: #f8f9fa;
      border: none;
    }
    .mod-tab {
      cursor: pointer;
    }
    .mod-tab.active {
      background-color: #007bff;
      color: white;
    }
    .spinner-container {
      height: 300px;
    }
    .modal-backdrop.show {
      filter: blur(5px);
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="#">FilmRuhu</a>
    </div>
  </nav>
  <div class="container my-4" id="modSection">
    <div class="d-flex justify-content-center flex-wrap gap-2" id="modTabs">
    </div>
  </div>
  <div class="container my-4" id="filmSection">
    <div class="row" id="filmCards">
    </div>
  </div>
  <div class="container my-3" id="navigationButtons">
    <div class="d-flex justify-content-center gap-3">
      <button class="btn btn-secondary" onclick="prevPage()">Önceki</button>
      <button class="btn btn-warning" onclick="shuffleFilms()">Karıştır</button>
      <button class="btn btn-secondary" onclick="nextPage()">Sonraki</button>
    </div>
  </div>
  <div class="modal fade" id="trailerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content bg-dark">
        <div class="modal-header">
          <h5 class="modal-title">Fragman</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Kapat"></button>
        </div>
        <div class="modal-body" id="trailerModalContent">
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const apiKey = "e39e95f412d05a40b4a42fbbbb665286";
    const mods = [
      { name: "Mutlu 😊", genre: 35 },
      { name: "Hüzünlü 😢", genre: 18 },
      { name: "Macera 🏞️", genre: 12 },
      { name: "Romantik ❤️", genre: 10749 },
      { name: "Komik 😂", genre: 35 },
      { name: "Gerilim 😱", genre: 53 },
      { name: "Bilim Kurgu 👽", genre: 878 },
      { name: "Fantastik 🧚", genre: 14 },
      { name: "Dram 🎭", genre: 18 },
      { name: "Aksiyon 🔥", genre: 28 },
      { name: "Belgesel 📚", genre: 99 },
      { name: "Korku 👻", genre: 27 },
      { name: "Animasyon 🎬", genre: 16 },
      { name: "Suç 🔍", genre: 80 },
      { name: "Drama 🎥", genre: 18 }
    ];
    let filmData = [];
    let currentFilmIndex = 0;
    let currentMod = mods[0];
    const modTabsContainer = document.getElementById('modTabs');
    mods.forEach(mod => {
      const btn = document.createElement('button');
      btn.className = "btn btn-outline-primary mod-tab";
      if (mod.name === currentMod.name) btn.classList.add('active');
      btn.textContent = mod.name;
      btn.onclick = () => {
        currentMod = mod;
        currentFilmIndex = 0;
        document.querySelectorAll('.mod-tab').forEach(tab => tab.classList.remove('active'));
        btn.classList.add('active');
        fetchMovies();
      };
      modTabsContainer.appendChild(btn);
    });
    async function fetchMovies() {
  const genreId = currentMod.genre;
  const totalPages = 5; // 5 sayfa, yaklaşık 100 film
  let allResults = [];
  showSpinner();
  try {
    for (let page = 1; page <= totalPages; page++) {
      const url = `https://api.themoviedb.org/3/discover/movie?api_key=${apiKey}&with_genres=${genreId}&language=tr-TR&page=${page}`;
      const response = await fetch(url);
      const data = await response.json();
      allResults = allResults.concat(data.results);
    }
    filmData = allResults;
    currentFilmIndex = Math.floor(Math.random() * filmData.length);
    renderFilm();
  } catch (error) {
    console.error("Filmler yüklenirken hata oluştu:", error);
  }
}
    function showSpinner() {
      const filmCardsContainer = document.getElementById('filmCards');
      filmCardsContainer.innerHTML = `
        <div class="d-flex justify-content-center align-items-center spinner-container">
          <div class="spinner-border text-light" role="status">
            <span class="visually-hidden">Yükleniyor...</span>
          </div>
        </div>`;
    }
    function renderFilm() {
      const filmCardsContainer = document.getElementById('filmCards');
      setTimeout(() => {
        if (!filmData.length) {
          filmCardsContainer.innerHTML = "<p class='text-center'>Film bulunamadı.</p>";
          return;
        }
        if (currentFilmIndex >= filmData.length) currentFilmIndex = filmData.length - 1;
        if (currentFilmIndex < 0) currentFilmIndex = 0;
        const film = filmData[currentFilmIndex];
        filmCardsContainer.innerHTML = `
          <div class="col-12">
            <div class="card mb-4">
              <div class="row g-0">
                <div class="col-md-4">
                  <img src="https://image.tmdb.org/t/p/w500${film.poster_path}" class="img-fluid rounded-start" alt="${film.title}">
                </div>
                <div class="col-md-8">
                  <div class="card-body">
                    <h3 class="card-title">${film.title}</h3>
                    <p class="card-text">${film.overview}</p>
                    <p class="card-text"><small>Çıkış Tarihi: ${formatReleaseDate(film.release_date)}</small></p>
                    <p class="card-text"><small>Puan: ${film.vote_average.toFixed(1)}/10</small></p>
                    <button class="btn btn-info" onclick="openTrailerModal(${film.id})">İngilizce Fragmanı İzle</button><br /><br >
                    <button class="btn btn-info" onclick="openTrailerModalTR(${film.id})">Türkçe Fragmanı İzle</button>
                <br /><br >
                    <p span style="font-size: 11px">Bazı filmlerin Türkçe fragmanı bulunmadığından, Orijinal fragmanı izlemek için "İngilizce Fragmanı İzle" butonuna tıklamanızı öneririz.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>`;
      }, 500);
    }
    function formatReleaseDate(dateString) {
  if (!dateString) return "";
  const parts = dateString.split("-");
  const year = parts[0],
        month = parts[1],
        day = parts[2];
  const monthNames = {
    "01": "Ocak",
    "02": "Şubat",
    "03": "Mart",
    "04": "Nisan",
    "05": "Mayıs",
    "06": "Haziran",
    "07": "Temmuz",
    "08": "Ağustos",
    "09": "Eylül",
    "10": "Ekim",
    "11": "Kasım",
    "12": "Aralık"
  };
  return `${parseInt(day)} ${monthNames[month]} ${year}`;
}
    function nextPage() {
      if (currentFilmIndex < filmData.length - 1) {
        currentFilmIndex++;
        showSpinner();
        renderFilm();
      }
    }
    function prevPage() {
      if (currentFilmIndex > 0) {
        currentFilmIndex--;
        showSpinner();
        renderFilm();
      }
    }
    function shuffleFilms() {
      for (let i = filmData.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [filmData[i], filmData[j]] = [filmData[j], filmData[i]];
      }
      currentFilmIndex = 0;
      showSpinner();
      renderFilm();
    }
    function openTrailerModal(movieId) {
      const modal = new bootstrap.Modal(document.getElementById('trailerModal'));
      const trailerContainer = document.getElementById('trailerModalContent');
      trailerContainer.innerHTML = `
        <div class="text-center">
          <div class="spinner-border text-light" role="status">
            <span class="visually-hidden">Yükleniyor...</span>
          </div>
        </div>`;
      const videoUrl = `https://api.themoviedb.org/3/movie/${movieId}/videos?api_key=${apiKey}&language=en-US`;
      fetch(videoUrl)
        .then(response => response.json())
        .then(videoData => {
          const trailers = videoData.results.filter(video => video.type === "Trailer" && video.site === "YouTube");
          if (trailers.length > 0) {
            const trailer = trailers[0];
            trailerContainer.innerHTML = `
              <div class="ratio ratio-16x9 mb-3">
                <iframe src="https://www.youtube.com/embed/${trailer.key}" title="Fragman" allowfullscreen></iframe>
              </div>
              <small class="d-block text-center text-muted">Platform: ${trailer.site}</small>
            `;
          } else {
            trailerContainer.innerHTML = `<p class="text-center">Fragman bulunamadı.</p>`;
          }
        })
        .catch(err => {
          trailerContainer.innerHTML = `<p class="text-center">Fragman yüklenirken hata oluştu.</p>`;
        });
      modal.show();
    }
    function openTrailerModalTR(movieId) {
      const modal = new bootstrap.Modal(document.getElementById('trailerModal'));
      const trailerContainer = document.getElementById('trailerModalContent');
      trailerContainer.innerHTML = `
        <div class="text-center">
          <div class="spinner-border text-light" role="status">
            <span class="visually-hidden">Yükleniyor...</span>
          </div>
        </div>`;
      const videoUrl = `https://api.themoviedb.org/3/movie/${movieId}/videos?api_key=${apiKey}&language=tr-TR`;
      fetch(videoUrl)
        .then(response => response.json())
        .then(videoData => {
          const trailers = videoData.results.filter(video => video.type === "Trailer" && video.site === "YouTube");
          if (trailers.length > 0) {
            const trailer = trailers[0];
            trailerContainer.innerHTML = `
              <div class="ratio ratio-16x9 mb-3">
                <iframe src="https://www.youtube.com/embed/${trailer.key}" title="Fragman" allowfullscreen></iframe>
              </div>
              <small class="d-block text-center text-muted">Platform: ${trailer.site}</small>
            `;
          } else {
            trailerContainer.innerHTML = `<p class="text-center">Fragman bulunamadı.</p>`;
          }
        })
        .catch(err => {
          trailerContainer.innerHTML = `<p class="text-center">Fragman yüklenirken hata oluştu.</p>`;
        });
      modal.show();
    }
    fetchMovies();
  </script>
<footer class="footer bg-dark text-light py-3">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-6 text-center text-md-start">
        <p class="mb-0">&copy; 2025 FilmRuhu. Tüm hakları saklıdır.</p>
      </div>
      <div class="col-md-6 text-center text-md-end">
        <a href="https://instagram.com/omergul3c" target="_blank" class="text-light me-3"><i class="fab fa-instagram fa-lg"></i></a>
        <a href="https://tiktok.com/@gulecco" target="_blank" class="text-light me-3"><i class="fab fa-tiktok fa-lg"></i></a>
        <a href="https://twitter.com/omergul3c" target="_blank" class="text-light me-3"><i class="fab fa-twitter fa-lg"></i></a>
        <a href="https://linkedin.com/in/gulecco" target="_blank" class="text-light"><i class="fab fa-linkedin fa-lg"></i></a>
      </div>
    </div>
  </div>
</footer>
</body>
</html>
