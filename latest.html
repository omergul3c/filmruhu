<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>En Yeni Çıkmış Filmler</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {background-color:#212529; color:#f8f9fa}
    .card {background-color:#343a40; color:#f8f9fa; border:none}
    .spinner-container {height:300px}
    .modal-backdrop.show {filter:blur(5px)}
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="#">FilmRuhu</a>
    </div>
  </nav>
  <div class="container my-4">
    <h1 class="text-center mb-4">En Yeni Çıkmış Filmler</h1>
    <div class="row" id="filmCards"></div>
    <div class="d-flex justify-content-center gap-3 my-3">
      <button class="btn btn-secondary" onclick="prevPage()">Önceki</button>
      <button class="btn btn-warning" onclick="shuffleFilms()">Karıştır</button>
      <button class="btn btn-secondary" onclick="nextPage()">Sonraki</button>
    </div>
  </div>
  <div class="modal fade" id="trailerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content bg-dark">
        <div class="modal-header">
          <h5 class="modal-title">Fragman</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Kapat"></button>
        </div>
        <div class="modal-body" id="trailerModalContent"></div>
      </div>
    </div>
  </div>
  <footer class="footer bg-dark text-light py-3">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-6 text-center text-md-start">
          <p class="mb-0">&copy; 2025 FilmRuhu. Tüm hakları saklıdır.</p>
        </div>
        <div class="col-md-6 text-center text-md-end">
          <a href="https://instagram.com/YOUR_PROFILE" target="_blank" class="text-light me-3"><i class="fab fa-instagram fa-lg"></i></a>
          <a href="https://tiktok.com/@YOUR_PROFILE" target="_blank" class="text-light me-3"><i class="fab fa-tiktok fa-lg"></i></a>
          <a href="https://twitter.com/YOUR_PROFILE" target="_blank" class="text-light me-3"><i class="fab fa-twitter fa-lg"></i></a>
          <a href="https://linkedin.com/in/YOUR_PROFILE" target="_blank" class="text-light"><i class="fab fa-linkedin fa-lg"></i></a>
        </div>
      </div>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const apiKey = "e39e95f412d05a40b4a42fbbbb665286";
    const genreMapping = {
      28:"Aksiyon", 12:"Macera", 16:"Animasyon", 35:"Komedi", 80:"Suç",
      99:"Belgesel", 18:"Dram", 10751:"Aile", 14:"Fantastik", 36:"Tarih",
      27:"Korku", 10402:"Müzik", 9648:"Gizem", 10749:"Romantik", 878:"Bilim Kurgu",
      10770:"TV Movie", 53:"Gerilim", 10752:"Savaş", 37:"Western"
    };
    let filmData = [], curIdx = 0;
    async function fetchMovies() {
      const totalPages = 5;
      showSpinner();
      let allResults = [];
      try {
        for(let page = 1; page <= totalPages; page++){
          const url = `https://api.themoviedb.org/3/movie/now_playing?api_key=${apiKey}&language=tr-TR&page=${page}`;
          let response = await fetch(url);
          let data = await response.json();
          allResults = allResults.concat(data.results);
        }
        filmData = allResults;
        curIdx = Math.floor(Math.random() * filmData.length);
        renderFilm();
      } catch(error) {
        console.error("Filmler yüklenirken hata oluştu:", error);
      }
    }
    function formatReleaseDate(dateString) {
  if (!dateString) return "";
  const parts = dateString.split("-");
  const year = parts[0],
        month = parts[1],
        day = parts[2];
  const monthNames = {
    "01": "Ocak",
    "02": "Şubat",
    "03": "Mart",
    "04": "Nisan",
    "05": "Mayıs",
    "06": "Haziran",
    "07": "Temmuz",
    "08": "Ağustos",
    "09": "Eylül",
    "10": "Ekim",
    "11": "Kasım",
    "12": "Aralık"
  };
  return `${parseInt(day)} ${monthNames[month]} ${year}`;
}
    function showSpinner(){
      document.getElementById("filmCards").innerHTML = `<div class="d-flex justify-content-center align-items-center spinner-container"><div class="spinner-border text-light" role="status"><span class="visually-hidden">Yükleniyor...</span></div></div>`;
    }
    function renderFilm(){
      const fc = document.getElementById("filmCards");
      setTimeout(() => {
        if(!filmData.length){
          fc.innerHTML = "<p class='text-center'>Film bulunamadı.</p>";
          return;
        }
        curIdx >= filmData.length && (curIdx = filmData.length - 1);
        curIdx < 0 && (curIdx = 0);
        const f = filmData[curIdx];
        let genres = f.genre_ids.map(id => genreMapping[id]).filter(x => x).join(", ");
        fc.innerHTML = `<div class="col-12"><div class="card mb-4"><div class="row g-0"><div class="col-md-4"><img src="https://image.tmdb.org/t/p/w500${f.poster_path}" class="img-fluid rounded-start" alt="${f.title}"></div><div class="col-md-8"><div class="card-body"><h3 class="card-title">${f.title}</h3><p class="card-text">${f.overview}</p><p class="card-text"><small>Çıkış Tarihi: ${f.release_date}</small></p><p class="card-text"><small>Puan: ${f.vote_average.toFixed(1)}/10</small></p><p class="card-text"><small>Modlar: ${genres}</small></p><button class="btn btn-info" onclick="openTrailerModal(${f.id})">Fragmanı İzle</button></div></div></div></div></div>`;
      }, 500);
    }
    function nextPage(){ curIdx < filmData.length - 1 && (curIdx++, showSpinner(), renderFilm()); }
    function prevPage(){ curIdx > 0 && (curIdx--, showSpinner(), renderFilm()); }
    function shuffleFilms(){
      for(let i = filmData.length - 1; i > 0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [filmData[i],filmData[j]] = [filmData[j],filmData[i]];
      }
      curIdx = 0;
      showSpinner();
      renderFilm();
    }
    function openTrailerModal(id){
      const m = new bootstrap.Modal(document.getElementById("trailerModal"));
      const tc = document.getElementById("trailerModalContent");
      tc.innerHTML = `<div class="text-center"><div class="spinner-border text-light" role="status"><span class="visually-hidden">Yükleniyor...</span></div></div>`;
      const url = `https://api.themoviedb.org/3/movie/${id}/videos?api_key=${apiKey}&language=en-US`;
      fetch(url).then(r=>r.json()).then(d=>{
        const t = d.results.filter(v => v.type==="Trailer" && v.site==="YouTube");
        t.length>0 ? tc.innerHTML = `<div class="ratio ratio-16x9 mb-3"><iframe src="https://www.youtube.com/embed/${t[0].key}" title="Fragman" allowfullscreen></iframe></div><small class="d-block text-center text-muted">Platform: ${t[0].site}</small>` : tc.innerHTML = `<p class="text-center">Fragman bulunamadı.</p>`;
      }).catch(e=>{
        tc.innerHTML = `<p class="text-center">Fragman yüklenirken hata oluştu.</p>`;
      });
      m.show();
    }
    fetchMovies();
  </script>
</body>
</html>
